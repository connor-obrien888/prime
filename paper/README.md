# PRIME Paper Figures and Analysis

This repo contains the jupyter notebook used to create the figures and do the analysis contained in O'Brien et al. 2023, as well as dataset/model generation scripts. For a convenient implementation of PRIME for python, see prime_lib. If the files in the `../data/` directory were not downloaded, they must be created by running the scripts in this directory so they can be used by `paper_plots.ipynb`. Scripts are intended to be run in the following order: `sw_scripts.py` -> `ds_hp.py` -> `algorithm_hp.py` -> `omni.py` -> `algorithm_hp.py`. `ks_custom.py` and `sw_lib.py` are libraries with utility functions used by the other files/scripts. The included files in this repo are each explained below.

```
paper_plots.ipynb
```
This notebook contains code to make the figures and analysis contained in O'Brien et al. 2023. Data used to create plots is stored in `../data/` directory. If you did not download that data, this notebook requires Wind and MMS data collected by running `sw_scripts.py` as a script, as well as model outputs generated by the `model_run.py` script.

```
model_run.py
```
This script trains the optimal version of PRIME and generates outputs for the training/test/validation datasets as well as at the bow shock nose. Algorithm hyperparameters are as determined by the `algorithm_hp.py` script, and dataset hyperparameters are as determined by the `ds_hp.py` script.

```
sw_scripts.py
```
This library contains dataset download/cleaning scripts used to collect the Wind and MMS data used in this study. Functions can be used in isolation, or the library can be run as a script to do all the steps in order automatically (this can take a long time, especially if your internet or machine are slow). Requires [CDASWS]{https://pypi.org/project/cdasws/} library for python, as well as cdflib or spacepy for cdf support.

```
ds_hp.py
```
This script searches over input dataset hyperparameters (length of timeseries used as input, how far in the future to do predictions, amount of input data that is allowed to be interpolated). Optimal dataset parameters are used by `algorithm_hp.py` and `model_run.py`.

```
algorithm_hp.py
```
This script searches over model hyperparameters (layer size, dropout rate/location, optimizer parameters) to find the optimal configuration of PRIME. This configuration is then used by `model_run.py`.

```
omni.py
```
This script propagates OMNI data from the bow shock nose (default OMNI propagation location) to MMS-1 using the phase front normals identified by OMNI's MVA routine in order to do proper comparison against PRIME.

```
ks_custom.py
```
This library contains the custom loss functions used to train PRIME's output to be physically meaningful probability distributions, as well as dataset preparation functions and objects used to scale and split the datasets.

```
sw_lib.py
```
Contains functions used to clean the data as well as do classification in order to exclude foreshock/magnetosheath/magnetosphere observations from the MMS dataset.

```
cdfdicts.py
```
Library containing the metadata used to create ISTP-compliant CDFs containing PRIME's outputs at the bow shock nose.